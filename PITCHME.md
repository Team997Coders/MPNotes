# 997 Motion Profiling Code Survey 

## Code Tour
## Plan

A Path Forward

---

### Team 135 Penn Robotics

- Uses Pathfinder Library
- Gens Path/Trajectory on the fly (with limited success)
- Feeds trajectory points to motors using Command subsystem
- Yanked from [Chief Delphi](https://www.chiefdelphi.com/forums/showthread.php?p=1745136 "Robot Code Never Starts")

+++?code=DriveAlongProfile.java&lang=java

@[11-13](Uses [Jaci Pathfinder](https://github.com/JacisNonsense/Pathfinder) library)
@[17](Implemented as WPILIB Command...useful)
@[28](50ms trajectory timing...keep reading...)
@[27-31](Ticks converted to meters...later converted into inches...ich!)
@[33](Normalizes power within setPoint range of -1..1)
@[35-39](Trajectory point feedback PID constants...note large D dampending...hmmm)
@[45-49](Heading correction PID constants)
@[53-54](Timer simply used to timeout command...5ms seems like too small default)
@[58](Class only takes waypoints...another constructor could take an already computed trajectory)
@[58](You could also do a straight line constructor to computes on the fly)
@[83](Trajetory generated on the fly...however it can take many (10's) seconds to complete...ouch!)
@[85-87](Tank modifier creates separate trajectory stream for each side of drive train)
@[92-93](Follower class from Jaci...computes motor output at point in time given trajectory feedforward and PID feedback)
@[98](Sets up follower and angle controller config values)
@[132-134](THE MEAT! Get the values to apply to motors at trajectory point time.  There is a problem...)
@[132-134](WIPLIB command scheduler runs every 20ms...timestep for trajectory calced for 50ms!)
@[138-147](Timeout the command if we are finished or take too long.  Good idea!)
@[149-150](Correct heading)

###### Team 135: [DriveAlongProfile.java](https://github.com/Team997Coders/MPNotes/blob/master/DriveAlongProfile.java)

---

### Team 135 Penn Robotics
#### Summary

- Command implementation attractive...simple
- No additional threads to synchronize
- Must sync quantized timing of trajectory to scheduler timing (20ms)
- Uses gyro for angle correction
- Timing drift of scheduler will be crummy because we are not running a real-time operating system
- Might work well enough?

---

### Team 217 Thunder Chickens

- Uses CRE Phoenix Library
- Consumes "normal" path/trajectory generated by [Vannaka MP Generator](https://github.com/vannaka/Motion_Profile_Generator) 
- Feeds trajectory points to Talon SRX buffer over CAN bus
- Called from a Command via execute() to keep buffer topped up
- Yanked from [CRE Examples](https://github.com/CrossTheRoadElec/Phoenix-Examples-Languages/blob/master/Java/MotionProfile/src/org/usfirst/frc/team217/robot/MotionProfileExample.java "MotionProfileExample.java")

---

## March 16-17 Plan 

- Lay out carpet in library
  - Tape off back line, switch edges, and scale corners for half of field
- Decide on MP implementation approach
  - Command fed
- Talon buffer fed
- Obtain robot constants from design (and/or experimentally derive)
  - Kv, Ka, Kj

---

## March 16-17 Plan (cont)

- Plot a path and generate CSV trajectories to scale (LHS, RHS -> near side, far side) with appropriate timestep (20ms for Command fed)
- Insure that path does not violate robot constraints and plots are continuous
- Integrate Floyd's code and/or create code to read in CSV and create and navigate a Trajectory data structure
- Write the MP drive class

---

## March 16-17 Plan (cont)
- Write code to log data from driving so that we can plot results for debugging purposes
- Integrate, test, rinse, repeat
- Write a method to graph results.
